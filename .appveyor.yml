---
image: Visual Studio 2019

shallow_clone: true

# set clone depth
clone_depth: 1

platform:
  - x64

configuration:
  - Release

matrix:
  fast_finish: false

only_commits:
  files:
    - src/
    - vc14/
    - .appveyor.yml
    - cmake/
    - CMakeLists.txt

install:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
  - cd C:\Tools\vcpkg
  - git pull
  - .\bootstrap-vcpkg.bat
  - .\vcpkg integrate install
  - cd %APPVEYOR_BUILD_FOLDER%

before_build:
 - mkdir build
 - cd build
 - cmake -DCMAKE_TOOLCHAIN_FILE=C:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake ..
 - cmake --build . --config Release
#  - cmake ..

build:
  project: otbr.vcxproj

# after_build:
  # - 7z a -tzip otservbr-global.zip -r .\vc14\*.exe -ir!.\vc14\*.dll
  # - vcpkg export boost-asio:x64-windows boost-lockfree:x64-windows boost-variant:x64-windows boost-filesystem:x64-windows boost-iostreams:x64-windows boost-system:x64-windows boost-system:x64-windows libmariadb:x64-windows pugixml:x64-windows spdlog:x64-windows curl:x64-windows jsoncpp:x64-windows cryptopp:x64-windows luajit:x64-windows --7zip

cache:
  - c:\tools\vcpkg\installed\

artifacts:
  - path: c:\**\vcpkg-export*.7z
  # - path: vc14\**\otservbr-global*.exe
  # - path: vc14\**\*.dll
  # - path: otservbr-global.zip
